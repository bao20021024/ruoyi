<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.medical.mapper.TMedicalOutpatientdoctorReceiverecordMapper">

    <resultMap type="TMedicalOutpatientdoctorReceiverecord" id="base">
        <result property="opDoctorReceiveRecordId" column="opDoctorReceiveRecordId"/>
        <result property="outpatientId" column="outpatientId"/>
        <result property="doctorId" column="doctorId"/>
        <result property="type" column="type"/>
        <result property="status" column="status"/>
        <result property="createTime" column="createTime"/>
    </resultMap>

    <resultMap type="TMedicalOutpatientdoctorReceiverecord" extends="base"
               id="TMedicalOutpatientdoctorReceiverecordResult">
        <association property="coi" javaType="CostOutpatientInfo">
            <result property="id" column="id"/>
            <result property="money" column="money"/>
            <result property="enableTime" column="enableTime"/>
            <result property="lossTime" column="lossTime"/>
            <result property="deadTime" column="deadTime"/>
            <result property="returnTime" column="returnTime"/>
            <result property="status" column="coiStatus"/>
            <result property="deposit" column="deposit"/>
            <result property="personid" column="personid"/>
            <association property="cpa" javaType="CostPersonArchives">
                <result property="id" column="cpaId"/>
                <result property="name" column="name"/>
                <result property="age" column="age"/>
                <result property="code" column="code"/>
                <result property="sex" column="sex"/>
                <association property="cs" javaType="CpoeSplitbed">
                    <result property="id" column="csId"/>
                    <result property="personId" column="personId"/>
                    <result property="doctorId" column="doctorId"/>
                    <result property="bedId" column="bedId"/>
                    <result property="createTime" column="csCreateTime"/>
                    <result property="remark" column="remark"/>
                    <association property="cb" javaType="CpoeBed">
                        <result property="id" column="cbId"/>
                        <result property="name" column="cbName"/>
                        <result property="sickroomId" column="sickroomId"/>
                        <result property="remark" column="cbRemark"/>
                    </association>
                </association>
            </association>
        </association>
        <association property="user" javaType="SysUser">
            <id property="userId" column="user_id"/>
            <result property="deptId" column="dept_id"/>
            <result property="userName" column="user_name"/>
            <result property="nickName" column="nick_name"/>
            <result property="email" column="email"/>
            <result property="phonenumber" column="phonenumber"/>
            <result property="sex" column="userSex"/>
            <result property="avatar" column="avatar"/>
            <result property="password" column="password"/>
            <result property="status" column="userStatus"/>
            <result property="delFlag" column="del_flag"/>
            <result property="loginIp" column="login_ip"/>
            <result property="loginDate" column="login_date"/>
            <result property="createBy" column="create_by"/>
            <result property="createTime" column="create_time"/>
            <result property="updateBy" column="update_by"/>
            <result property="updateTime" column="update_time"/>
            <result property="remark" column="remark"/>
        </association>
    </resultMap>

    <sql id="selectTMedicalOutpatientdoctorReceiverecordVo">
        select opDoctorReceiveRecordId, outpatientId, doctorId, type, status, createTime from t_medical_outpatientdoctor_receiverecord
    </sql>

    <sql id="selJoin">
        select opDoctorReceiveRecordId, outpatientId ,doctorId, t.type, t.status, t.createTime, name, personid,nick_name
        from (select opDoctorReceiveRecordId, outpatientId ,doctorId, type, tr.status, tr.createTime, name, personid
        from t_medical_outpatientdoctor_receiverecord tr,t_medical_cost_outpatient_info ti,t_medical_cost_person_archives ta
        where tr.outpatientId = ti.id and ti.personid = ta.id) t
        left join sys_user u on t.doctorId = u.user_id
    </sql>

    <sql id="selSickroom">
        select t.opDoctorReceiveRecordId, t.outpatientId, t.doctorId, t.type, t.status, t.money,t.coiStatus,t.personid,t.nick_name,t.name,t.code,p.bedId,p.cbName,p.csCreateTime
        from (
            select tr.opDoctorReceiveRecordId, tr.outpatientId, tr.doctorId, tr.type, tr.status, tr.createTime,ti.money,ti.status coiStatus,ti.personid,su.nick_name,ta.name,ta.code
            from t_medical_outpatientdoctor_receiverecord tr, t_medical_cost_outpatient_info ti,sys_user su,t_medical_cost_person_archives ta
            where tr.type = 2 and tr.outpatientId = ti.id and tr.doctorId = su.user_id and ti.personid = ta.id
            ) t
        left join
            (
            select ts.bedId,ts.personId,ts.createTime csCreateTime, tb.name cbName, tb.sickroomId, tb.remark cbRemark
            from t_medical_cpoe_splitbed ts,t_medical_cpoe_bed tb
            where ts.bedId = tb.id
            ) p
        on t.personid = p.personId
    </sql>

    <select id="selectTMedicalOutpatientdoctorReceiverecordList" parameterType="TMedicalOutpatientdoctorReceiverecord"
            resultMap="TMedicalOutpatientdoctorReceiverecordResult">
        <include refid="selJoin"/>
        where 1 = 1
        <if test="outpatientId != null  and outpatientId != ''">and outpatientId = #{outpatientId}</if>
        <if test="doctorId != null  and doctorId != ''">and doctorId = #{doctorId}</if>
        <if test="type != null ">and t.type = #{type}</if>
        <if test="status != null and opDoctorReceiveRecordId == null">and t.status = #{status}</if>
        <if test="status != null and opDoctorReceiveRecordId != null">and t.status &lt; #{status}</if>
        <if test="createTime != null ">and t.createTime = #{createTime}</if>
        order by t.status,opDoctorReceiveRecordId
    </select>

    <select id="selectTMedicalOutpatientdoctorReceiverecordByOpDoctorReceiveRecordId" parameterType="String"
            resultMap="TMedicalOutpatientdoctorReceiverecordResult">
        <include refid="selJoin"/>
        where opDoctorReceiveRecordId = #{opDoctorReceiveRecordId}
    </select>

    <select id="selectListAboutSickroom" parameterType="TMedicalOutpatientdoctorReceiverecord"
            resultMap="TMedicalOutpatientdoctorReceiverecordResult">
        <include refid="selSickroom"/>
        <where>
            <if test="outpatientId != null  and outpatientId != ''">and t.name like concat('%',#{outpatientId},'%')</if>
            <if test="doctorId != null  and doctorId != ''">and t.nick_name like concat('%',#{doctorId},'%')</if>
            <if test="createTime != null ">and p.csCreateTime = #{createTime}</if>
        </where>
    </select>

    <insert id="insertTMedicalOutpatientdoctorReceiverecord" parameterType="TMedicalOutpatientdoctorReceiverecord">
        insert into t_medical_outpatientdoctor_receiverecord
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="opDoctorReceiveRecordId != null">opDoctorReceiveRecordId,</if>
            <if test="outpatientId != null">outpatientId,</if>
            <if test="doctorId != null">doctorId,</if>
            <if test="type != null">type,</if>
            <if test="status != null">status,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="opDoctorReceiveRecordId != null">#{opDoctorReceiveRecordId},</if>
            <if test="outpatientId != null">#{outpatientId},</if>
            <if test="doctorId != null">#{doctorId},</if>
            <if test="type != null">#{type},</if>
            <if test="status != null">#{status},</if>
        </trim>
    </insert>

    <update id="updateTMedicalOutpatientdoctorReceiverecord" parameterType="TMedicalOutpatientdoctorReceiverecord">
        update t_medical_outpatientdoctor_receiverecord
        <trim prefix="SET" suffixOverrides=",">
            <if test="outpatientId != null">outpatientId = #{outpatientId},</if>
            <if test="doctorId != null">doctorId = #{doctorId},</if>
            <if test="type != null">type = #{type},</if>
            <if test="status != null">status = #{status},</if>
            <if test="createTime != null">createTime = #{createTime},</if>
        </trim>
        where opDoctorReceiveRecordId = #{opDoctorReceiveRecordId}
    </update>

    <delete id="deleteTMedicalOutpatientdoctorReceiverecordByOpDoctorReceiveRecordId" parameterType="String">
        delete from t_medical_outpatientdoctor_receiverecord where opDoctorReceiveRecordId = #{opDoctorReceiveRecordId}
    </delete>

    <delete id="deleteTMedicalOutpatientdoctorReceiverecordByOpDoctorReceiveRecordIds" parameterType="String">
        delete from t_medical_outpatientdoctor_receiverecord where opDoctorReceiveRecordId in
        <foreach item="opDoctorReceiveRecordId" collection="array" open="(" separator="," close=")">
            #{opDoctorReceiveRecordId}
        </foreach>
    </delete>
</mapper>